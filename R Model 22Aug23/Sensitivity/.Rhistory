#----START PSA constants and functions----
#Constants
NormDist <- qnorm(0.975)
#Random functions #Maybe move to GlobalFunctions at the end
# @Michal Litkiewicz
# Random draws from a beta distribution using mean (p1) and either SD/SE or sample size (p2) as arguments
f_rbeta <- function (n, p1, p2) {
if (p2<1) { # p2 is not a sample size, so it's an SE
if (p2>0) {
tmp <- max(p1*(1-p1)/p2^2-1,0)
a <- p1*tmp
b <- (1-p1)*tmp
return(rbeta(n, a, b))
} else {
return(rep(p1, n))
}
} else { # SE would be lower than 1, so p2 is a sample size
a <- p1*p2
b <- (1-p1)*p2
return(rbeta(n, a, b))
}
}
#Random draws from a beta distribution constrained by values in samples_high
f_rbeta_constrained <- function (n, p, ss, p_high, ss_high, samples_high) {
if (p>0 & p_high>0) {
if (p_high>p) {
a <- p*ss
b <- (1-p)*ss
v <- a*b/((a+b)^2*(a+b+1))
a_high <- p_high*ss_high
b_high <- (1-p_high)*ss_high
v_high <- a_high*b_high/((a_high+b_high)^2*(a_high+b_high+1))
aux_p <- p/p_high
aux_v <- max((v-v_high*aux_p^2)/(v+p_high^2), 0.00000001)
aux_a <- aux_p*(aux_p*(1*aux_p)/aux_v-1)
aux_b <- (1-aux_p)*(aux_p*(1*aux_p)/aux_v-1)
aux_samp <- rbeta(n, aux_a, aux_b)
return(aux_samp*samples_high[1:n])
} else {
return(samples_high[1:n])
}
} else {
return(rep(0,n))
}
}
#Random draws from a gamma distribution using mean and SD/SE as arguments
f_rgamma <- function(n, m, s) {
if (m>0) {
b <- m/s^2
a <- m*b
return(rgamma(n, a, b))
} else {
return(rep(0, n))
}
}
#---- Read inputs ----
# Source required files
# Store directory locations
current_dir <- paste0(getwd(),'/')
inputs_dir <- paste0(getwd(),"/Excel2R/")
results_dir <- paste0(getwd(),"/Results/Intermediate Results/")
sensitivity_dir <- paste0(getwd(),"/Sensitivity/")
setwd(inputs_dir)
read_inputs()
# Read in functions
setwd(current_dir)
source('GlobalFunctions.R')
# Read in inputs
setwd(inputs_dir)
read_inputs()
# Read sensitivity data
setwd(sensitivity_dir)
read_data_from_file("SensitivitySamplesForPSA")
#-----------------------------------------[TO BE COMPLETED - Constants from Excel]---------------------------------------------------
View(iMisc)
iMisc[17,2]
View(iMisc)
soc_test_costs_SE
iMisc[18:22,2]
iMisc[18:22,2]=2
iMisc[18:22,2]=c(2,2,1,1,1)
iMisc[18:22,2]
if (iMisc[18:22,2]<2){a}
iMisc[27,2]
iMisc[18:22,2]<2
SE_or_perc <- iMisc[18:22,2]<2
ifelse{TRUE,1,0}
ifelse(TRUE,1,0)
ifelse(TRUE,1,)
ifelse(TRUE,,)
ifelse(TRUE,,1)
ifelse(SE_or_perc[1],soc_test_costs_SE <- stdErr_soc_test_costs*soc_test_costs,"soc_test_costs_SE from Excel")
